From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: John Doe <john.doe@somewhere.on.planet>
Date: Mon, 18 Mar 2024 23:34:39 +0800
Subject: Patching u-boot rk35xx files arch/arm/dts/rk3566-ts-pi-u-boot.dtsi
 arch/arm/dts/rk3566-ts-pi.dts

Signed-off-by: John Doe <john.doe@somewhere.on.planet>
---
 arch/arm/dts/rk3566-ts-pi-u-boot.dtsi | 11 --
 arch/arm/dts/rk3566-ts-pi.dts         | 59 +++++-----
 2 files changed, 31 insertions(+), 39 deletions(-)

diff --git a/arch/arm/dts/rk3566-ts-pi-u-boot.dtsi b/arch/arm/dts/rk3566-ts-pi-u-boot.dtsi
index d1b5551be3..aaee137136 100644
--- a/arch/arm/dts/rk3566-ts-pi-u-boot.dtsi
+++ b/arch/arm/dts/rk3566-ts-pi-u-boot.dtsi
@@ -3,16 +3,5 @@
 / {
 	chosen {
 		stdout-path = &uart2;
 	};
 };
-
-&sdhci {
-	cap-mmc-highspeed;
-	mmc-ddr-1_8v;
-};
-
-&uart2 {
-	clock-frequency = <24000000>;
-	bootph-all;
-	status = "okay";
-};
diff --git a/arch/arm/dts/rk3566-ts-pi.dts b/arch/arm/dts/rk3566-ts-pi.dts
index ae42a5668c..780d93dc11 100644
--- a/arch/arm/dts/rk3566-ts-pi.dts
+++ b/arch/arm/dts/rk3566-ts-pi.dts
@@ -4,15 +4,10 @@
 
 / {
 	model = "RK3566 TS Pi";
 	compatible = "rockchip,rk3566-tspi", "rockchip,rk3566";
 
-	aliases {
-		mmc0 = &sdhci;
-		mmc1 = &sdmmc0;
-	};
-
 	dc_12v: dc-12v {
 		compatible = "regulator-fixed";
 		regulator-name = "dc_12v";
 		regulator-always-on;
 		regulator-boot-on;
@@ -37,18 +32,18 @@
 		regulator-boot-on;
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
 		vin-supply = <&vcc5v0_sys>;
 	};
-};
 
-&combphy1 {
-	status = "okay";
-};
-
-&combphy2 {
-	status = "okay";
+	sdio_pwrseq: sdio-pwrseq {
+		compatible = "mmc-pwrseq-simple";
+		clocks = <&rk809 1>;
+		clock-names = "ext_clock";
+		post-power-on-delay-ms = <200>;
+		reset-gpios = <&gpio2 RK_PB1 GPIO_ACTIVE_LOW>;
+	};
 };
 
 &cpu0 {
 	cpu-supply = <&vdd_cpu>;
 };
@@ -112,10 +107,14 @@
 		vcc6-supply = <&vcc3v3_sys>;
 		vcc7-supply = <&vcc3v3_sys>;
 		vcc8-supply = <&vcc3v3_sys>;
 		vcc9-supply = <&vcc3v3_sys>;
 
+		pwrkey {
+			status = "okay";
+		};
+
 		regulators {
 			vdd_logic: DCDC_REG1 {
 				regulator-always-on;
 				regulator-boot-on;
 				regulator-min-microvolt = <500000>;
@@ -296,26 +295,10 @@
 				regulator-state-mem {
 					regulator-off-in-suspend;
 				};
 			};
 		};
-
-		rk809_codec: codec {
-			#sound-dai-cells = <0>;
-			compatible = "rockchip,rk809-codec", "rockchip,rk817-codec";
-			clocks = <&cru I2S1_MCLKOUT>;
-			clock-names = "mclk";
-			assigned-clocks = <&cru I2S1_MCLKOUT>, <&cru I2S1_MCLK_TX_IOE>;
-			assigned-clock-rates = <12288000>;
-			assigned-clock-parents = <&cru I2S1_MCLKOUT_TX>, <&cru I2S1_MCLKOUT_TX>;
-			pinctrl-names = "default";
-			pinctrl-0 = <&i2s1m0_mclk>;
-			hp-volume = <20>;
-			spk-volume = <3>;
-			mic-in-differential;
-			status = "okay";
-		};
 	};
 };
 
 &pmu_io_domains {
 	pmuio2-supply = <&vcc3v3_pmu>;
@@ -349,10 +332,26 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&sdmmc0_bus4 &sdmmc0_clk &sdmmc0_cmd &sdmmc0_det>;
 	status = "okay";
 };
 
+&sdmmc1 {
+	max-frequency = <150000000>;
+	supports-sdio;
+	bus-width = <4>;
+	disable-wp;
+	cap-sd-highspeed;
+	cap-sdio-irq;
+	keep-power-in-suspend;
+	mmc-pwrseq = <&sdio_pwrseq>;
+	non-removable;
+	pinctrl-names = "default";
+	pinctrl-0 = <&sdmmc1_bus4 &sdmmc1_cmd &sdmmc1_clk>;
+	sd-uhs-sdr104;
+	status = "okay";
+};
+
 &tsadc {
 	rockchip,hw-tshut-mode = <1>;
 	rockchip,hw-tshut-polarity = <0>;
 	status = "okay";
 };
@@ -360,8 +359,12 @@
 &saradc {
 	vref-supply = <&vcca_1v8>;
 	status = "okay";
 };
 
+&uart1 {
+	status = "okay";
+};
+
 &uart2 {
 	status = "okay";
 };
-- 
Created with Armbian build tools https://github.com/armbian/build

